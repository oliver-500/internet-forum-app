"use strict";(self.webpackChunkinternet_forum=self.webpackChunkinternet_forum||[]).push([[831],{1491:(K,g,a)=>{a.r(g),a.d(g,{AdminPanelModule:()=>H});var p=a(6814),f=a(4828),l=a(6223);class v{constructor(){this.id=-1,this.name=""}}class x{}class C{constructor(){this.accesses=[],this.accessesRoom=[]}}var e=a(5879),T=a(4669),y=a(1856),A=a(9862);let b=(()=>{class i{constructor(t){this.http=t,this.baseUrl=`${window.location.protocol}//${window.location.hostname}:${window.location.port}/api/v1/permissions`}getAll(){return this.http.get(this.baseUrl)}static#e=this.\u0275fac=function(s){return new(s||i)(e.LFG(A.eN))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var U=a(6802),w=a(2939),Z=a(2296),_=a(1919),h=a(7466),d=a(5313),M=a(2599),O=a(5986);function R(i,c){1&i&&(e.TgZ(0,"th",25),e._uU(1,"Room"),e.qZA())}function J(i,c){if(1&i&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&i){const t=c.$implicit;e.xp6(1),e.Oqu(t.name)}}function P(i,c){if(1&i&&(e.TgZ(0,"th",25),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.name," ")}}const S=function(){return{standalone:!0}};function G(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",29),e.NdJ("ngModelChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw().$implicit,n=e.oxw(2).index,m=e.oxw();return e.KtG(m.changePermission(n,r,o.id))}),e.qZA()}if(2&i){const t=e.oxw().$implicit,s=e.oxw().$implicit,o=e.oxw(2).$implicit,r=e.oxw();e.Q6J("ngModel",null!==o.formGroup.get(s.name+t.id)&&o.formGroup.get(s.name+t.id).value)("color",r.color)("ngModelOptions",e.DdM(3,S))}}function k(i,c){if(1&i&&(e.TgZ(0,"td",26),e.YNc(1,G,1,4,"mat-checkbox",28),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Q6J("ngIf",t.formGroup)}}function Y(i,c){if(1&i&&(e.TgZ(0,"div"),e.ynx(1,27),e.YNc(2,P,2,1,"th",18),e.YNc(3,k,2,1,"td",19),e.BQk(),e.qZA()),2&i){const t=c.$implicit;e.xp6(1),e.Q6J("matColumnDef",t.name)}}function N(i,c){1&i&&e._UZ(0,"tr",30)}function Q(i,c){1&i&&e._UZ(0,"tr",31)}function B(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",10)(2,"span"),e._uU(3,"User type:"),e.qZA(),e.TgZ(4,"mat-radio-group",11)(5,"mat-radio-button",12),e._uU(6,"Forum User"),e.qZA(),e.TgZ(7,"mat-radio-button",13),e._uU(8,"Moderator"),e.qZA(),e.TgZ(9,"mat-radio-button",14),e._uU(10,"Admin"),e.qZA()()(),e.TgZ(11,"div",15)(12,"table",16),e.ynx(13,17),e.YNc(14,R,2,0,"th",18),e.YNc(15,J,2,1,"td",19),e.BQk(),e.YNc(16,Y,4,1,"div",20),e.YNc(17,N,1,0,"tr",21),e.YNc(18,Q,1,0,"tr",22),e.qZA()(),e.TgZ(19,"div",23)(20,"button",24),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().index,r=e.oxw();return e.KtG(r.expandItem(o,!1))}),e._uU(21," Cancel "),e.qZA(),e.TgZ(22,"button",24),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().index,r=e.oxw();return e.KtG(r.save(o))}),e._uU(23," Save "),e.qZA()()()}if(2&i){const t=e.oxw().$implicit,s=e.oxw();e.xp6(4),e.Q6J("color",s.color),e.xp6(8),e.Q6J("dataSource",null==t.userAccess?null:t.userAccess.accessesRoom),e.xp6(4),e.Q6J("ngForOf",s.permissionTypes),e.xp6(1),e.Q6J("matHeaderRowDef",s.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",s.displayedColumns)}}const F=function(i,c,t,s){return{"even-list-item":i,"odd-list-item":c,"new-list-item-odd":t,"new-list-item-even":s}};function I(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"mat-list-item",4)(1,"form",5),e.NdJ("ngSubmit",function(){const r=e.CHM(t).index,n=e.oxw();return e.KtG(n.onSubmit(r))}),e.TgZ(2,"div",1)(3,"div",6)(4,"span",7),e._uU(5),e.qZA(),e.TgZ(6,"mat-slide-toggle",8),e.NdJ("change",function(){const r=e.CHM(t).index,n=e.oxw();return e.KtG(n.expandItem(r,!0))}),e._uU(7),e.qZA()(),e.YNc(8,B,24,5,"div",9),e.qZA()()()}if(2&i){const t=c.$implicit,s=c.index,o=e.oxw();e.Q6J("ngClass",e.l5B(6,F,s%2==0&&(null==t.user?null:t.user.registered),s%2==1&&(null==t.user?null:t.user.registered),s%2==1&&!(null!=t.user&&t.user.registered),s%2==0&&!(null!=t.user&&t.user.registered))),e.xp6(1),e.Q6J("formGroup",t.formGroup),e.xp6(4),e.hij(" ",t.user.username," "),e.xp6(1),e.Q6J("color",o.color),e.xp6(1),e.hij(" ",!0===t.user.registered?" Registered":"Waiting registration"," "),e.xp6(1),e.Q6J("ngIf",!0===t.isExpanded)}}const D=[{path:"users",component:(()=>{class i{constructor(t,s,o,r,n,m){this.userService=t,this.formBuilder=s,this.roomService=o,this.permissionService=r,this.userAccessesService=n,this._snackBar=m,this.items=[],this.rooms=[],this.permissionTypes=[],this.displayedColumns=[],this.color="primary",this.checked=!1}isChecked(t,s){let o=this.items[s];for(let r of o.userAccess?.accesses)if(r.permission?.id===t)return!0;return!1}ngOnInit(){this.roomService.getRooms().subscribe({next:t=>{this.rooms=t},error:t=>{}}),this.permissionService.getAll().subscribe({next:t=>{this.permissionTypes=t,this.displayedColumns.push("Room"),this.displayedColumns.push(...this.permissionTypes.map(s=>s.name))},error:t=>{}}),this.userService.getAllUsersWithRegistrationInfo().subscribe({next:t=>{this.items=t.map(s=>({user:s,isExpanded:!1,formGroup:this.formBuilder.group({isRegistered:[s.registered,l.kI.required]})})),this.items.sort((s,o)=>s.user?.registered&&!o.user?.registered?1:!s.user?.registered&&o.user?.registered?-1:1)},error:t=>{}})}doesAccessPermissionExists(t,s,o){let r=this.items[t].userAccess?.accesses;if(r)for(let n of r)if(n.permission?.name===s&&n.room?.id==o)return console.log("Pronasao: "+s+o),!0;return!1}expandItem(t,s){if(!this.rooms||!this.permissionTypes)return;let o=this.items[t].formGroup;if(this.items[t].isExpanded){this.items[t].isExpanded=!this.items[t].isExpanded;for(let r of this.rooms)for(let n of this.permissionTypes)console.log("remvoing"+n.name+r.id),o.removeControl(n.name+r.id);return console.log("exit"),void(s||o.get("isRegistered")?.setValue(!o.get("isRegistered")?.value))}this.userAccessesService.getOneByUser(this.items[t].user?.id).subscribe({next:r=>{this.items[t].userAccess=r,this.items[t].userAccess&&(this.items[t].userAccess.accessesRoom=this.rooms);for(let n of this.rooms)for(let m of this.permissionTypes)console.log("adding"+m.name+n.id),o.addControl(m.name+n.id,this.formBuilder.control(this.doesAccessPermissionExists(t,m.name,n.id),l.kI.required))},error:r=>{}}),o.addControl("userType",this.formBuilder.control({value:this.items[t].user?.userGroup?.toString(),disabled:this.items[t].isExpanded&&this.items[t].user?.registered},l.kI.required)),this.items[t].isExpanded=!this.items[t].isExpanded}onSubmit(t){this.items[t].formGroup.valid||console.error("Form is invalid.")}save(t){let s=this.items[t].formGroup,o=new C;for(let n of this.rooms)for(let m of this.permissionTypes)if(console.log("adding"+m.name+n.id),s.get(m.name+n.id)&&!0===s.get(m.name+n.id).value){let u={};u.permission=new v,u.permission.name=m.name,u.room=new x,u.room.id=n.id,o.userId=this.items[t].user?.id,o.accesses.push(u)}let r={userType:s.value.userType,activated:s.value.isRegistered,userAccess:o,userId:this.items[t].user?.id};this.userService.acivateUser(r).subscribe({next:n=>{this.items[t].user.registered=s.value.isRegistered,this.expandItem(t,!1),s.get("isRegistered")?.setValue(this.items[t].user.registered),this._snackBar.open("Succesfully added","OK",{duration:3e3,panelClass:["custom-snackbar"]})},error:n=>{this._snackBar.open("Something went wrong","OK",{duration:3e3,panelClass:["custom-snackbar"]})}}),console.log(r)}changePermission(t,s,o){let r=this.items[t].formGroup.get(s.name+o);r&&r.setValue(!r.value)}static#e=this.\u0275fac=function(s){return new(s||i)(e.Y36(T.K),e.Y36(l.qu),e.Y36(y.n),e.Y36(b),e.Y36(U.E),e.Y36(w.ux))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-users"]],decls:7,vars:1,consts:[[1,"container"],[1,"vertical-container"],["id","users-header"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[3,"formGroup","ngSubmit"],[1,"horizontal-container"],[1,"username"],["formControlName","isRegistered",3,"color","change"],["class","vertical-container",4,"ngIf"],[1,"user-type-container"],["formControlName","userType","aria-label","Select an user type",3,"color"],["value","0"],["value","1"],["value","2"],[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","Room"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"user-actions-container"],["mat-raised-button","",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"matColumnDef"],[3,"ngModel","color","ngModelOptions","ngModelChange",4,"ngIf"],[3,"ngModel","color","ngModelOptions","ngModelChange"],["mat-header-row",""],["mat-row",""]],template:function(s,o){1&s&&(e.TgZ(0,"div",0)(1,"mat-list")(2,"div",1)(3,"div",2)(4,"h2"),e._uU(5,"Users"),e.qZA()()(),e.YNc(6,I,9,11,"mat-list-item",3),e.qZA()()),2&s&&(e.xp6(6),e.Q6J("ngForOf",o.items))},dependencies:[p.mk,p.sg,p.O5,l._Y,l.JJ,l.JL,l.sg,l.u,Z.lW,_.i$,_.Tg,l.On,h.VQ,h.U0,d.BZ,d.fO,d.as,d.w1,d.Dz,d.nj,d.ge,d.ev,d.XQ,d.Gk,M.Rr,O.oG],styles:[".container[_ngcontent-%COMP%]{width:100%;padding:10px 0}mat-list[_ngcontent-%COMP%]{width:98%;border-radius:10px;border:3px solid aquamarine}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;padding:0;margin:0;border:1px solid #ccc}.vertical-container[_ngcontent-%COMP%]{align-items:center;padding:5px;width:98%}.horizontal-container[_ngcontent-%COMP%]{width:100%;justify-content:space-between;align-items:center}.user-actions-container[_ngcontent-%COMP%]{margin-top:10px;display:flex;width:100%;align-items:center;justify-content:flex-end}.table-container[_ngcontent-%COMP%]{margin:10px}button[_ngcontent-%COMP%]{margin-left:5px;margin-right:5px}.even-list-item[_ngcontent-%COMP%]{background-color:#f0f8ff}.odd-list-item[_ngcontent-%COMP%]{background-color:#7fffd4}.new-list-item-odd[_ngcontent-%COMP%]{background-image:linear-gradient(135deg,transparent 50%,rgba(0,0,0,.5) 90%);background-color:#7fffd4}.new-list-item-even[_ngcontent-%COMP%]{background-image:linear-gradient(135deg,transparent 50%,rgba(0,0,0,.5) 90%);background-color:#f0f8ff}table[_ngcontent-%COMP%]{border:2px solid #ccc}"]})}return i})(),canActivate:[a(8009).I]}];let z=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({imports:[f.Bz.forChild(D),f.Bz]})}return i})();var j=a(9100);let H=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({imports:[p.ez,z,j.M]})}return i})()}}]);