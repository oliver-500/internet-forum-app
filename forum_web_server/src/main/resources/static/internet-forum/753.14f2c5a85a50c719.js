"use strict";(self.webpackChunkinternet_forum=self.webpackChunkinternet_forum||[]).push([[753],{8753:(T,p,s)=>{s.r(p),s.d(p,{AuthModule:()=>q});var d=s(6814),u=s(4828),n=s(6223);class f{}var t=s(5879),l=s(4483),c=s(2939),g=s(2032),m=s(9157),h=s(2296);let v=(()=>{class r{constructor(o,e,i,a,I){this.formBuilder=o,this.authService=e,this.router=i,this.route=a,this._snackBar=I,this.request={username:"",password:""},this.message="",this.loginForm=this.formBuilder.group({username:["",n.kI.required],password:["",n.kI.required]})}ngOnInit(){this.authService.isLoggedIn()&&this.router.navigate(["/home/rooms"]),this.route.queryParams.subscribe(o=>{const e=o.code;if(!e)return;let i=new f;i.code=e,this.authService.requestJwt(i).subscribe({next:a=>{localStorage.setItem("token",a.token),this._snackBar.open("Successfull login","OK",{duration:3e3,panelClass:["custom-snackbar"]}),this.router.navigate(["/home/rooms"])},error:a=>{console.log("error")}})})}logInGithub(){this.authService.loginWithGithub().subscribe({next:o=>{window.location.href=o.redirectURL},error:o=>{this._snackBar.open("Something went wrong","OK",{duration:3e3,panelClass:["custom-snackbar"]})}})}onFormSubmit(){if(this.loginForm.valid){const o={username:this.loginForm.value.username,password:this.loginForm.value.password};this.authService.loginUser(o).subscribe({next:e=>{e.loggedIn?e.registered?(sessionStorage.setItem("username",o.username),this._snackBar.open("Successfull login","OK",{duration:3e3,panelClass:["custom-snackbar"]}),this.authService.user={isLoggingIn:!0},this.router.navigate(["/auth/confirm"])):this._snackBar.open("Your account needs confirmation by administrator.","OK",{duration:3e3,panelClass:["custom-snackbar"]}):this._snackBar.open("Login failed.","OK",{duration:3e3,panelClass:["custom-snackbar"]})},error:e=>{this._snackBar.open("Login failed.","OK",{duration:3e3,panelClass:["custom-snackbar"]})}})}}clearForm(){this.loginForm.value.username="",this.loginForm.value.password=""}static#t=this.\u0275fac=function(e){return new(e||r)(t.Y36(n.qu),t.Y36(l.u),t.Y36(u.F0),t.Y36(u.gz),t.Y36(c.ux))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-login-page"]],decls:24,vars:3,consts:[[1,"container"],[1,"login-form",3,"formGroup","ngSubmit"],[1,"auth-container"],[1,"form-item"],["matInput","","type","text","formControlName","username"],["matInput","","type","password","formControlName","password"],["mat-flat-button","","type","submit",1,"form-item",3,"disabled"],["routerLink","/auth/signup"],["mat-flat-button","",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return i.onFormSubmit()}),t.TgZ(2,"div",2)(3,"h2"),t._uU(4,"Log in to your account"),t.qZA(),t.TgZ(5,"mat-form-field",3)(6,"mat-label"),t._uU(7,"Username"),t.qZA(),t._UZ(8,"input",4),t.qZA(),t.TgZ(9,"mat-form-field",3)(10,"mat-label"),t._uU(11,"Password"),t.qZA(),t._UZ(12,"input",5),t.qZA(),t.TgZ(13,"button",6),t._uU(14,"Log in"),t.qZA(),t.TgZ(15,"div",3)(16,"h3"),t._uU(17,"Not registered?"),t.qZA(),t.TgZ(18,"a",7),t._uU(19,"Sign up"),t.qZA()(),t.TgZ(20,"button",8),t.NdJ("click",function(){return i.logInGithub()}),t._uU(21,"Log in with Github"),t.qZA(),t.TgZ(22,"h4"),t._uU(23),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",i.loginForm),t.xp6(12),t.Q6J("disabled",!i.loginForm.valid),t.xp6(10),t.Oqu(i.message))},dependencies:[u.rH,g.Nt,m.KE,m.hX,n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u,h.lW]})}return r})(),b=(()=>{class r{constructor(o,e,i,a){this.formBuilder=o,this.authService=e,this.router=i,this._snackBar=a,this.message="",this.signupForm=o.group({username:["",n.kI.required],email:["",[n.kI.email,n.kI.required]],password:["",n.kI.required]})}onFormSubmit(){this.signupForm.valid&&this.authService.signupUser({username:this.signupForm.value.username,password:this.signupForm.value.password,email:this.signupForm.value.email}).subscribe({next:e=>{this.message=e.isRegistered,this._snackBar.open(e.registered?"Registration successfull. Check your email for account activation.":"User could not be registered.","OK",{duration:3e3,panelClass:["custom-snackbar"]}),this.clearForm()},error:e=>{this._snackBar.open("Something went wrong","OK",{duration:3e3,panelClass:["custom-snackbar"]})}})}clearForm(){this.signupForm.value.username="",this.signupForm.value.email="",this.signupForm.value.password=""}ngOnInit(){this.authService.isLoggedIn()&&this.router.navigate(["/home/rooms"]),console.log("signup ")}static#t=this.\u0275fac=function(e){return new(e||r)(t.Y36(n.qu),t.Y36(l.u),t.Y36(u.F0),t.Y36(c.ux))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-signup-page"]],decls:26,vars:3,consts:[[1,"container"],[1,"login-form",3,"formGroup","ngSubmit"],[1,"auth-container"],[1,"form-item"],["matInput","","type","text","formControlName","username"],["matInput","","type","email","formControlName","email"],["matInput","","type","password","formControlName","password"],["mat-flat-button","","type","submit",1,"form-item",3,"disabled"],["routerLink","/auth/login"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return i.onFormSubmit()}),t.TgZ(2,"div",2)(3,"h2"),t._uU(4,"Register your account"),t.qZA(),t.TgZ(5,"mat-form-field",3)(6,"mat-label"),t._uU(7,"Username"),t.qZA(),t._UZ(8,"input",4),t.qZA(),t.TgZ(9,"mat-form-field",3)(10,"mat-label"),t._uU(11,"Email"),t.qZA(),t._UZ(12,"input",5),t.qZA(),t.TgZ(13,"mat-form-field",3)(14,"mat-label"),t._uU(15,"Password"),t.qZA(),t._UZ(16,"input",6),t.qZA(),t.TgZ(17,"button",7),t._uU(18,"Sign up"),t.qZA(),t.TgZ(19,"div",3)(20,"h3"),t._uU(21,"Already registered?"),t.qZA(),t.TgZ(22,"a",8),t._uU(23,"Sign in"),t.qZA()(),t.TgZ(24,"h4"),t._uU(25),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",i.signupForm),t.xp6(16),t.Q6J("disabled",!i.signupForm.valid),t.xp6(8),t.Oqu(i.message))},dependencies:[u.rH,g.Nt,m.KE,m.hX,n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u,h.lW]})}return r})(),Z=(()=>{class r{constructor(o,e,i,a){this.router=o,this.formBuilder=e,this.authService=i,this._snackBar=a,this.username=null,this.message="",this.isWaitingForResponse=!1,this.confirmationForm=e.group({code:["",n.kI.required]}),this.username=sessionStorage.getItem("username")}goBack(){sessionStorage.removeItem("username"),this.router.navigate(["/auth/login"])}onFormSubmit(){this.isWaitingForResponse=!0;var o=sessionStorage.getItem("username");if(null===o)return void this.router.navigate(["/auth/login"]);if(!this.confirmationForm.valid)return void(this.isWaitingForResponse=!1);const e={username:o,code:this.confirmationForm.value.code};this.authService.confirmLogin(e).subscribe({next:i=>{i.verified?(localStorage.setItem("token",i.token),this.authService.user={username:e.username,id:i.id,loggedIn:!0,userGroup:i.userGroup,isLoggingIn:!1},console.log(this.authService.user.id),this.message="Confirmation successfull.",setTimeout(()=>{this.router.navigate(["/home/rooms"])},300),sessionStorage.removeItem("username")):this.message="Confirmation failed.",this.clearForm()},error:i=>{this._snackBar.open("Confirmation failed","OK",{duration:3e3,panelClass:["custom-snackbar"]}),this.isWaitingForResponse=!1}})}clearForm(){this.confirmationForm.value.code=""}static#t=this.\u0275fac=function(e){return new(e||r)(t.Y36(u.F0),t.Y36(n.qu),t.Y36(l.u),t.Y36(c.ux))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-confirm-login-page"]],decls:16,vars:4,consts:[[1,"container"],[1,"login-form",3,"formGroup","ngSubmit"],[1,"auth-container"],[1,"form-item"],["matInput","","type","text","formControlName","code"],["mat-flat-button","","type","submit",1,"form-item",3,"disabled"],["routerLink","/auth/login"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return i.onFormSubmit()}),t.TgZ(2,"div",2)(3,"h2"),t._uU(4),t.qZA(),t.TgZ(5,"mat-form-field",3)(6,"mat-label"),t._uU(7,"Code"),t.qZA(),t._UZ(8,"input",4),t.qZA(),t.TgZ(9,"button",5),t._uU(10,"Confirm"),t.qZA(),t.TgZ(11,"div",3)(12,"a",6),t._uU(13,"Go back"),t.qZA()(),t.TgZ(14,"h4"),t._uU(15),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",i.confirmationForm),t.xp6(3),t.hij("",i.username,", enter confirmation code sent to your email address"),t.xp6(5),t.Q6J("disabled",!i.confirmationForm.valid||i.isWaitingForResponse),t.xp6(6),t.Oqu(i.message))},dependencies:[u.rH,g.Nt,m.KE,m.hX,n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u,h.lW]})}return r})();var F=s(5592);const S=[{path:"login",component:v},{path:"signup",component:b},{path:"confirm",component:Z,canActivate:[(()=>{class r{constructor(o,e){this.router=o,this.authService=e}canActivate(){return console.log("can activate guard "),new F.y(o=>{null===sessionStorage.getItem("username")?(o.next(!1),this.router.navigate(["/auth/login"])):null!==this.authService.user&&!0===this.authService.user.isLoggingIn?o.next(!0):(o.next(!1),this.router.navigate(["/auth/login"])),o.complete()})}static#t=this.\u0275fac=function(e){return new(e||r)(t.LFG(u.F0),t.LFG(l.u))};static#e=this.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()]}];let C=(()=>{class r{static#t=this.\u0275fac=function(e){return new(e||r)};static#e=this.\u0275mod=t.oAB({type:r});static#o=this.\u0275inj=t.cJS({imports:[u.Bz.forChild(S),u.Bz]})}return r})();var k=s(9100),A=s(9862);let q=(()=>{class r{static#t=this.\u0275fac=function(e){return new(e||r)};static#e=this.\u0275mod=t.oAB({type:r});static#o=this.\u0275inj=t.cJS({imports:[d.ez,C,k.M,A.JF]})}return r})()}}]);