"use strict";(self.webpackChunkinternet_forum=self.webpackChunkinternet_forum||[]).push([[605],{5605:(et,h,r)=>{r.r(h),r.d(h,{UserModuleModule:()=>W});var c=r(6814),d=r(4828),t=r(5879),g=r(1856),f=r(4483),p=r(1919);function x(i,a){if(1&i&&(t.TgZ(0,"div",4)(1,"span"),t._uU(2),t.qZA()()),2&i){const e=t.oxw().$implicit;t.xp6(2),t.hij("",e.newCommentsCount," comments waiting approval")}}const w=function(i,a){return{"even-list-item":i,"odd-list-item":a}};function S(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"mat-list-item",2),t.NdJ("click",function(){const s=t.CHM(e).$implicit,m=t.oxw();return t.KtG(m.openRoom(s.id))}),t._uU(1),t.YNc(2,x,3,1,"div",3),t.qZA()}if(2&i){const e=a.$implicit,o=a.index;t.Q6J("ngClass",t.WLB(3,w,o%2==0,o%2!=0)),t.xp6(1),t.hij(" ",e.name," "),t.xp6(1),t.Q6J("ngIf",e.newCommentsCount)}}let T=(()=>{class i{constructor(e,o,n){this.roomService=e,this.router=o,this.authService=n,this.rooms=[]}ngOnInit(){0==this.authService.user?.userGroup?this.roomService.getRooms().subscribe({next:e=>{this.rooms=e},error:e=>{}}):(1==this.authService.user?.userGroup||2==this.authService.user?.userGroup)&&this.roomService.getRoomWithNewCommentCount().subscribe({next:e=>{this.rooms=e},error:e=>{}})}openRoom(e){console.log("soba"+e),this.router.navigate(["/home/rooms",e])}static#t=this.\u0275fac=function(o){return new(o||i)(t.Y36(g.n),t.Y36(d.F0),t.Y36(f.u))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-sections"]],decls:3,vars:1,consts:[[1,"container"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],["class","new-comments-count",4,"ngIf"],[1,"new-comments-count"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0)(1,"mat-list"),t.YNc(2,S,3,6,"mat-list-item",1),t.qZA()()),2&o&&(t.xp6(2),t.Q6J("ngForOf",n.rooms))},dependencies:[c.mk,c.sg,c.O5,p.i$,p.Tg],styles:[".container[_ngcontent-%COMP%]{width:100%;padding:10px 0}.even-list-item[_ngcontent-%COMP%]{background-color:#f0f8ff}.odd-list-item[_ngcontent-%COMP%]{background-color:#7fffd4}mat-list[_ngcontent-%COMP%]{width:98%;border-radius:10px;border:3px solid aquamarine}mat-list-item[_ngcontent-%COMP%]:hover{cursor:pointer}.new-comments-count[_ngcontent-%COMP%]{position:absolute;right:10px;font-size:small;bottom:0}"]})}return i})();var _=r(8009),l=r(7700);class O{}var Z=r(2032),M=r(9157),u=r(6223),C=r(2296);function k(i,a){if(1&i&&(t.TgZ(0,"h2"),t._uU(1,"Add new comment to room: "),t.TgZ(2,"i"),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.data.room)}}function R(i,a){if(1&i&&(t.TgZ(0,"h2"),t._uU(1,"Edit comment by "),t.TgZ(2,"i"),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.comment.author)}}let v=(()=>{class i{constructor(e,o){this.dialogRef=e,this.data=o,this.comment=new O}onCancelClick(){this.dialogRef.close()}onSaveClick(){this.data.isEdit?this.dialogRef.close({comment:this.comment,isEdit:!0}):(console.log(this.comment.content+"?????????????"),this.dialogRef.close({content:this.comment.content}))}ngOnInit(){this.data.isEdit&&(this.comment=this.data.comment)}static#t=this.\u0275fac=function(o){return new(o||i)(t.Y36(l.so),t.Y36(l.WI))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-new-comment-dialog"]],decls:11,vars:5,consts:[[4,"ngIf"],[1,"textarea"],["appearance","fill"],["spellcheck","false","matInput","","placeholder","Enter comment","name","comment",3,"ngModel","ngModelChange"],["mat-button","",3,"click"],["mat-button","",3,"mat-dialog-close","disabled","click"]],template:function(o,n){1&o&&(t.TgZ(0,"mat-dialog-content"),t.YNc(1,k,4,1,"h2",0),t.YNc(2,R,4,1,"h2",0),t.TgZ(3,"div",1)(4,"mat-form-field",2)(5,"textarea",3),t.NdJ("ngModelChange",function(m){return n.comment.content=m}),t.qZA()()()(),t.TgZ(6,"mat-dialog-actions")(7,"button",4),t.NdJ("click",function(){return n.onCancelClick()}),t._uU(8,"Cancel"),t.qZA(),t.TgZ(9,"button",5),t.NdJ("click",function(){return n.onSaveClick()}),t._uU(10,"Save"),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("ngIf",!n.data.isEdit),t.xp6(1),t.Q6J("ngIf",n.data.isEdit),t.xp6(3),t.Q6J("ngModel",n.comment.content),t.xp6(4),t.Q6J("mat-dialog-close",n.comment.content)("disabled",0==(null==n.comment.content?null:n.comment.content.length)))},dependencies:[c.O5,Z.Nt,M.KE,u.Fj,u.JJ,C.lW,l.ZT,l.xY,l.H8,u.On],styles:["textarea[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}mat-form-field[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content}mat-dialog-content[_ngcontent-%COMP%]{width:100%}mat-dialog-action[_ngcontent-%COMP%]{width:100%}.textarea[_ngcontent-%COMP%]{width:100%}"]})}return i})();class D{}class P{}class b{}var I=r(4669),N=r(9862);let A=(()=>{class i{constructor(e){this.http=e,this.baseUrl=`${window.location.protocol}//${window.location.hostname}:${window.location.port}/api/v1/comments`}postComment(e){return this.http.post(`${this.baseUrl}/${e.roomId}/create`,e)}approveComment(e){return this.http.post(`${this.baseUrl}/approve/${e.id}`,e)}editComment(e){return this.http.post(`${this.baseUrl}/${e.roomId}/update`,e)}deleteComment(e){return this.http.post(`${this.baseUrl}/${e.roomId}/delete`,e)}deleteUnnaprovedComment(e){return this.http.post(`${this.baseUrl}/deleteUnapproved/${e.id}`,e)}static#t=this.\u0275fac=function(o){return new(o||i)(t.LFG(N.eN))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var U=r(6802),J=r(2939),y=r(617),E=r(830);function Y(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().index,s=t.oxw();return t.KtG(s.openEditCommentDialog(n))}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()}}function z(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().index,s=t.oxw();return t.KtG(s.approveComment(n))}),t.TgZ(1,"mat-icon"),t._uU(2,"done"),t.qZA()()}}function $(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",4),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().index,s=t.oxw();return t.KtG(s.updateComment(n))}),t.TgZ(1,"mat-icon"),t._uU(2,"save"),t.qZA()()}if(2&i){const e=t.oxw().$implicit;t.Q6J("disabled",!e.isEdited)}}function F(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,s=t.oxw();return t.KtG(s.deleteComment(n.id,n.approved))}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA()()}}function B(i,a){1&i&&(t.TgZ(0,"div"),t._uU(1,"Waiting approval"),t.qZA())}const K=function(i,a,e,o){return{"even-list-item":i,"odd-list-item":a,"new-list-item-odd":e,"new-list-item-even":o}};function Q(i,a){if(1&i&&(t.TgZ(0,"mat-list-item",7)(1,"div",8)(2,"div",1)(3,"div",9),t._uU(4),t.qZA(),t.TgZ(5,"div"),t._uU(6),t.qZA()(),t.TgZ(7,"div",10),t._uU(8),t.qZA(),t.TgZ(9,"div",1)(10,"div",11),t.YNc(11,Y,3,0,"button",12),t.YNc(12,z,3,0,"button",12),t.YNc(13,$,3,1,"button",13),t.YNc(14,F,3,0,"button",12),t.qZA(),t.YNc(15,B,2,0,"div",14),t.qZA()()()),2&i){const e=a.$implicit,o=a.index,n=t.oxw();t.Q6J("ngClass",t.l5B(9,K,o%2==0&&e.approved,o%2==1&&e.approved,o%2==1&&!e.approved,o%2==0&&!e.approved)),t.xp6(4),t.hij(" ",e.author," "),t.xp6(2),t.hij(" ",n.formatDate(null==e.postedDatetime?null:e.postedDatetime.toString())," "),t.xp6(2),t.hij(" ",e.content," "),t.xp6(3),t.Q6J("ngIf",n.doesPermissionExist("update",e.approved)),t.xp6(1),t.Q6J("ngIf",!e.approved),t.xp6(1),t.Q6J("ngIf",e.approved&&n.doesPermissionExist("update",e.approved)),t.xp6(1),t.Q6J("ngIf",n.doesPermissionExist("delete",e.approved)),t.xp6(1),t.Q6J("ngIf",!e.approved)}}const q=[{path:"rooms",component:T,canActivate:[_.I]},{path:"rooms/:id",component:(()=>{class i{approveComment(e){console.log("approve");var o=new D;this.room?.comments?.at(e),o.approved=!0,o.approved&&(o.content=this.room?.comments?.at(e)?.content),o.id=this.room?.comments?.at(e)?.id,this.commentService.approveComment(o).subscribe({next:s=>{this._snackBar.open("Comment approved.","OK",{duration:3e3,panelClass:["custom-snackbar"]}),this.room&&this.getRoom(this.room.id)},error:s=>{}})}updateComment(e){var o=new P;o.content=this.room?.comments?.at(e)?.content,o.id=this.room?.comments?.at(e)?.id,o.roomId=this.room?.id,this.commentService.editComment(o).subscribe({next:n=>{this.room&&this.getRoom(this.room.id),this._snackBar.open("Comment edit success.","OK",{duration:3e3,panelClass:["custom-snackbar"]})},error:n=>{this._snackBar.open("Something went wrong.","OK",{duration:3e3,panelClass:["custom-snackbar"]})}})}getRoom(e){0==this.authService.user?.userGroup?this.roomService.getRoomWithAllowedComments(e).subscribe({next:o=>{this.room=o,this.room?.comments?.map(n=>{n.postedDatetime=new Date(n.postedDatetime)}),this.sortComments(this.room?.comments),this.room?.comments&&(this.pagedComments=this.room?.comments.slice(0,this.pageSize))},error:o=>{}}):(1==this.authService.user?.userGroup||2==this.authService.user?.userGroup)&&this.roomService.getRoom(e).subscribe({next:o=>{this.room=o,this.room?.comments?.map(n=>{new Date(n.postedDatetime),n.postedDatetime=new Date(n.postedDatetime)}),this.sortComments(this.room?.comments),this.room?.comments&&(this.pagedComments=this.room?.comments.slice(0,this.pageSize))},error:o=>{}})}constructor(e,o,n,s,m,L,X,V,tt){this.roomService=e,this.route=o,this.datePipe=n,this.userService=s,this.dialog=m,this.authService=L,this.commentService=X,this.userAccessService=V,this._snackBar=tt,this.accesses=[],this.room=null,this.pagedComments=[],this.pageSize=20,this.pageSizeOptions=[3,10,20]}openNewCommentDialog(){this.dialog.open(v,{data:{room:this.room?.name,isEdit:!1},width:"500px",height:"300px"}).afterClosed().subscribe(o=>{o&&(o.author=this.authService.user?.username,o.userId=this.authService.user?.id,console.log(o.userId+"      id"+o),o.roomId=this.room?.id,this.commentService.postComment(o).subscribe({next:n=>{this.getRoom(this.room?.id),this._snackBar.open("Succesfully added","OK",{duration:3e3,panelClass:["custom-snackbar"]})},error:n=>{this._snackBar.open("Try later","OK",{duration:3e3})}}))})}openEditCommentDialog(e){var o={...this.room?.comments?.[e]};this.dialog.open(v,{data:{room:this.room,isEdit:!0,comment:o},width:"500px",height:"300px"}).afterClosed().subscribe(s=>{s&&this.room?.comments?.[e]?.content!==s.comment.content&&o&&this.room?.comments&&(o.isEdited=!0,o.content=s.comment.content,this.room.comments[e]=s.comment,this.pagedComments=this.room?.comments.slice(0,this.pageSize))})}doesPermissionExist(e,o){if(this.authService.user?.userGroup&&2===this.authService.user.userGroup&&!o)return!0;for(let n of this.accesses)if(n.permission?.name.toLowerCase()===e.toLowerCase())return!0;return!1}ngOnInit(){console.log("USER ID: "+this.authService.user?.id),this.room={};const e=this.route.snapshot.paramMap.get("id");e&&(this.room.id=+e,this.getRoom(this.room.id),console.log(this.authService.user?.id+" dsadsa"+this.room.id),this.userAccessService.getMyAccesses({userId:this.authService.user?.id,roomId:this.room.id}).subscribe({next:n=>{this.accesses=n},error:n=>{}}))}sortComments(e){e.sort((o,n)=>{if(o.approved&&n.approved){if(o.postedDatetime&&n.postedDatetime){const s=new Date(o.postedDatetime);return new Date(n.postedDatetime).getTime()-s.getTime()}return 1}if(o.approved&&!n.approved)return 1;if(!n.approved&&n.approved)return-1;if(o.postedDatetime&&n.postedDatetime){const s=new Date(o.postedDatetime);return new Date(n.postedDatetime).getTime()-s.getTime()}return-1})}formatDate(e){if(null==e)return;const o=new Date(e),n=this.datePipe.transform(o,"HH:mm / dd-MM-yyyy ");return null!=n?n:void 0}onPageChange(e){const o=e.pageIndex*e.pageSize,n=o+e.pageSize;this.room?.comments&&(this.pagedComments=this.room?.comments.slice(o,n))}deleteComment(e,o){if(o){let n=new b;n.id=e,n.roomId=this.room?.id,this.commentService.deleteComment(n).subscribe({next:s=>{this._snackBar.open("Succesfully deleted","OK",{duration:3e3,panelClass:["custom-snackbar"]}),this.getRoom(this.room?.id)},error:s=>{this._snackBar.open("Something went wrong","OK",{duration:3e3,panelClass:["custom-snackbar"]})}})}else{let n=new b;n.id=e,n.roomId=this.room?.id,this.commentService.deleteUnnaprovedComment(n).subscribe({next:s=>{this._snackBar.open("Succesfully deleted","OK",{duration:3e3,panelClass:["custom-snackbar"]}),this.getRoom(this.room?.id)},error:s=>{this._snackBar.open("Something went wrong","OK",{duration:3e3,panelClass:["custom-snackbar"]})}})}}static#t=this.\u0275fac=function(o){return new(o||i)(t.Y36(g.n),t.Y36(d.gz),t.Y36(c.uU),t.Y36(I.K),t.Y36(l.uw),t.Y36(f.u),t.Y36(A),t.Y36(U.E),t.Y36(J.ux))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-room"]],decls:13,vars:6,consts:[[1,"container"],[1,"vertical-container"],["id","room-header"],["id","add-button"],["mat-icon-button","",3,"disabled","click"],[3,"pageSize","pageSizeOptions","length","page"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"horizontal-container"],[1,""],[1,"comment-content-section"],[1,"actions-container"],["mat-icon-button","",3,"click",4,"ngIf"],["mat-icon-button","",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["mat-icon-button","",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0)(1,"mat-list")(2,"div",1)(3,"div",2)(4,"h2"),t._uU(5),t.qZA()(),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return n.openNewCommentDialog()}),t.TgZ(8,"mat-icon"),t._uU(9,"add"),t.qZA()()()(),t.TgZ(10,"div",1)(11,"mat-paginator",5),t.NdJ("page",function(m){return n.onPageChange(m)})("page",function(m){return n.onPageChange(m)}),t.qZA()(),t.YNc(12,Q,16,14,"mat-list-item",6),t.qZA()()),2&o&&(t.xp6(5),t.Oqu(null==n.room?null:n.room.name),t.xp6(2),t.Q6J("disabled",!n.doesPermissionExist("create",!0)),t.xp6(4),t.Q6J("pageSize",n.pageSize)("pageSizeOptions",n.pageSizeOptions)("length",null==n.room||null==n.room.comments?null:n.room.comments.length),t.xp6(1),t.Q6J("ngForOf",n.pagedComments))},dependencies:[c.mk,c.sg,c.O5,C.RK,p.i$,p.Tg,y.Hw,E.NW],styles:[".container[_ngcontent-%COMP%]{width:100%;padding:10px 0;margin-left:0}.even-list-item[_ngcontent-%COMP%]{background-color:#f0f8ff}.odd-list-item[_ngcontent-%COMP%]{background-color:#7fffd4}.new-list-item-odd[_ngcontent-%COMP%]{background-image:linear-gradient(135deg,transparent 50%,rgba(0,0,0,.5) 80%);background-color:#7fffd4}.new-list-item-even[_ngcontent-%COMP%]{background-image:linear-gradient(135deg,transparent 50%,rgba(0,0,0,.5) 80%);background-color:#f0f8ff}#add-button[_ngcontent-%COMP%]{flex:1}#room-header[_ngcontent-%COMP%]{flex:6}mat-list[_ngcontent-%COMP%]{width:98%;border-radius:10px;border:3px solid aquamarine}.user-section[_ngcontent-%COMP%]{flex:1}.comment-content-section[_ngcontent-%COMP%]{flex:4;padding:5px;white-space:wrap;word-break:break-all}.vertical-container[_ngcontent-%COMP%]{align-items:center;padding:5px}.horizontal-container[_ngcontent-%COMP%]{align-items:flex-start;flex-wrap:wrap}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;padding:0;margin:0;border:1px solid #ccc}.vertical-container[_ngcontent-%COMP%]{align-items:center}.actions-container[_ngcontent-%COMP%]{flex:.5;flex-wrap:wrap;justify-content:right}"]})}return i})(),canActivate:[_.I]}];let j=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275mod=t.oAB({type:i});static#o=this.\u0275inj=t.cJS({imports:[d.Bz.forChild(q),d.Bz]})}return i})();var H=r(9100);let W=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275mod=t.oAB({type:i});static#o=this.\u0275inj=t.cJS({imports:[c.ez,j,H.M]})}return i})()}}]);